
---
type: blog
status: 未发布
created: 2022-02-11 21:34:07
updated: 2022-02-12 21:34:07
tags: java
categories: 
---


## 概念解析

先来看几个比较容易混淆的概念：

* **字符：** 简单的说字符就是各种文字和符号的总称，一个字符可以是一个中文汉字、一个英文字母、一个阿拉伯数字、一个标点符号、一个图形符号（如 emjoy）或者控制符号（如回车）等。
* **字符集：** 顾名思义，字符集就是多个字符的集合，不同的字符集中包含的字符不一样、对字符的编码方式也不一样。例如 GB 2312 是中国国家标准的简体中文字符集，主要收录了简化汉字（6763 个）在内的 7445 个图形字符，而 ASCII 字符集只包含了 128 字符，另外常见的字符集还有：GBK 字符集、GB 18030 字符集、Big 5 字符集、Unicode 字符集等。
* **码点值**：在每个字符集中都会字符进行编号，字符对应的编号就是该字符在该字符集中的码点值，比如在 ASCII 字符集中，字母 A 对应的编号 65，那么 65 就是字符 A 在 ASCII 字符集中的码点值。
* **字符编码：** 字符编码就是指的是一种映射规则，根据这个映射规则可以将某个字符映射成对应的二进制数据，简单的讲就是字符对应的码点值如何在计算机中存储。例如 ASCII 字符编码规定每个字符使用一个字节来存储，并且字节中的低 7 位表示字符对应的码点值，在这个编码规则下字母 A 的码点值是 65（ASCII 码），用单字节表示就是 0 x 41，因此写入存储设备的时候就是二进制的 01000001。

## 编码模型

目前存在两种编码模型，简单编码模型和现代编码模型。

### 简单编码模型

在这种编码模型里，一个字符集定义了这个字符集里包含什么字符，同时把每个字符如何对应成计算机里的比特也进行了定义，最典型的是 ASCII 字符集，直接定义了 `A -> 0100 0001`。

### 现代编码模型

在现代编码模型里要知道一个字符如何映射成计算机里比特，需要经过如下几个步骤：

1. 知道一个系统需要支持哪些字符，这些字符的集合被称为字符表（Character repertoire）；
2. 给字符表里的抽象字符编上一个数字，也就是字符集合到一个整数集合的映射，这种映射称为编码字符集（CCS: Coded Character Set），unicode 字符集就是属于这一层的概念，它跟计算机里的什么进制啊没有任何关系，它是完全数学的抽象的。
3. 将 CCS 里字符对应的整数转换成有限长度的比特值，便于以后计算机使用一定长度的二进制形式表示该整数，这个对应关系被称为字符编码表（CEF: Character Encoding Form）UTF-8，UTF-16 都属于这层。
4. 对于 CEF 得到的比特值具体如何在计算机中进行存储传输，由于存在大端小端的问题，这跟跟具体的操作系统相关，字符编码方案（CES: Character Encoding Scheme）考虑的就是这个问题。

## ASCII 和 Unicode

### ASCII 字符集

前文中提到过 ASCII 字符集使用了简单编码模型，也就是说在定义字符集的同时一并定义了字符在计算机中如何使使用二进制表示，一次性将现代编码模型中的前三步完成了。下图展示了 ASCII 字符集中字符与码点值之间的关系，同时 ASCII 字符集还规定了在计算机中每个字符占用一个字节，最前面的 1 位统一规定为 0，后七位位字符码点值对应的二进制。

![](附件/image/Java%20中的%20char%20类型能否存储中文_image_1.png)

### Unicode 字符集

ASCII 字符集表示的字符量有限，即使后续对其有过拓展，但受限于单个字节的存储方式，最多也只能表示 256 个字符。Unicode 字符集是一个很大的字符集合，现在的规模可以容纳 100 多万个符号。每个符号的编码都不一样，比如，U+0639 表示阿拉伯字母 Ain，U+0041 表示英语的大写字母 A，U+4 E 25 表示汉字 “严”。

Unicode 使用的是现代编码模型，定义出字符集以后只完成了前两步，还需要考虑在计算机中如何表示，于是就出现了 UTF-8、UTF-6 以及 UTF-32 这些编码方式，它们的作用简单的理解就是将字符对应的码点值映射成唯一的二进制数据。

#### UTF-8 编码

UTF-8 最大的一个特点，就是它是一种变长的编码方式，它可以使用 1~4 个字节表示一个符号，根据不同的符号而变化字节长度，下图总结了 UTF-8 的编码规则。

![](附件/image/Java%20中的%20char%20类型能否存储中文_image_2.png)

UTF-8 在存储英文字母时，使用一个字节来存储，存储中文时，使用的是三个字节。以汉字 “严” 为例，“严” 的 unicode 是 U+4 E 25（100111000100101），根据上表，可以发现 4 E 25 处在第三行的范围内（0000 0800-0000 FFFF），因此 “严” 的 UTF-8 编码需要三个字节，即格式是 “1110 xxxx 10 xxxxxx 10 xxxxxx”。然后，从“严” 的最后一个二进制位开始，依次从后向前填入格式中的 x，多出的位补 0。这样就得到了，“严”的 UTF-8 编码是“11100100 10111000 10100101”。


#### UTF-16

UTF-16 也是一种可变长的编码方式，不过它编码的最小单元是 2 字节，也就是说即使存储的英文字母，也需要两个字节的空间，下图展示了 UTF-16 的编码规则。

![](附件/image/Java%20中的%20char%20类型能否存储中文_image_3.png)

由于 UTF-16 使用了两个字节作为最小单元，所以需要考虑存储时大小端的问题，于是 UTF-16 中就包括三种：UTF-16，UTF-16 BE（Big Endian）和 UTF-16 LE（Little Endian）。UTF-16 BE 和 UTF-16 LE 不难理解，分别代表大端和小端方式，而 UTF-16 就需要通过在文件开头以名为 BOM（Byte Order Mark）的字符来表明文件是 Big Endian 还是 Little Endian，开头是 FEFF 则是大端，FFEF 则是小端。

## Java 中的 char 类型能否存储中文

答案是肯定的，Java 中的 char 可以用来存储中文。

Java 中的 char 固定占两个字节，使用 UTF-16 的编码方式对 Unicode 字符集中的 U+0000 到 U+FFFF 进行编码，所以处在这个范围内的字符都是可以被存储的，但是如果超出了这个范围，就无法再使用 char 来存储了，必须使用 String 来存储。

## Java 中 String 如何来存储字符串

在 Java 1.8 之前，Java 使用的 char 数组来存储字符串，对于一个 char 可以表示的字符，那么就用一个 char 来存储，否则则用两个 char 来存储，这也是字符串可以用来存储 U+0000 到 U+FFFF 之外字符的原因。不过在使用 Java 中 String 的时候需要注意，如果字符串中存在一些不常用的字符，在获取字符串长度的时候可能会出现问题，应为最终的长度统计的是 char 的个数，而不是字符串中字符的个数。

```java
public static void main(String[] args) {
    System.out.println("🀎".length());
}

// 输出结果为 2
```

## Java 中 String 底层数据结构由 char[] 换成 byte[]

更换的主要目的是为了节省存储空间，原先使用 char 数组来存储的时候，即使是存储的英文字母，也必须使用两个字节，这显然是非常浪费存储空间的，所以在 Java 1.9 之后使用 byte 数组做了替换。当存储的内容只有英文字母（单字节字符）的时候，那么就用一个字节来存储一个字符，当字符串中由其他字符的时候，就换成双字节来存储。

## 参考资料

1. [字符、字符集、字符编码的基础知识科普 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/260192496)
2. [代码点(Code Point)和代码单元(Code Unit)_GeekLeee的博客-CSDN博客](https://blog.csdn.net/GeekLeee/article/details/84966934)
3. [刨根究底字符编码之十——Unicode字符集的编码方式以及码点、码元 - 笨笨阿林 - 博客园 (cnblogs.com)](https://www.cnblogs.com/benbenalin/p/6921553.html)
4. [Unicode中UTF-8与UTF-16编码详解 - 掘金 (juejin.cn)](https://juejin.cn/post/6844903590155272199)
5. [Java中关于Char存储中文到底是2个字节还是3个还是4个？ - 知乎 (zhihu.com)](https://www.zhihu.com/question/279539793/answer/1830657398)